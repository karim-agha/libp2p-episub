syntax = "proto2";

package rpc.pb;

/// Represents a member of the p2p network
message AddressablePeer {
	required bytes peer_id = 1;
	repeated bytes addresses = 2;
}

// Represents a message that is sent between peer nodes
message Rpc {
	required string topic = 1;
	oneof Action {
		Join join = 2;
		JoinAccepted joinAccepted = 3;
		ForwardJoin forwardJoin = 4;
		Neighbor neighbor = 5;
		Shuffle shuffle = 6;
		ShuffleReply shuffleReply = 7;
		Disconnect disconnect = 8;
		Message message = 9;
	}
}

message Join {
	required uint32 ttl = 1;
	required AddressablePeer peer = 2;
}

message JoinAccepted {
	required AddressablePeer peer = 1;
}

message ForwardJoin {
	required uint32 ttl = 2;
	required AddressablePeer peer = 3;
}

message Neighbor {
	required AddressablePeer peer = 1;
	required Priority priority = 2;

	enum Priority {
		LOW = 0;
		HIGH = 1;
	}
}

message Shuffle {
	required uint32 ttl = 2;
	required AddressablePeer origin = 3;
	repeated AddressablePeer active = 4;
	repeated AddressablePeer passive = 5;
}

message ShuffleReply {
	repeated AddressablePeer nodes = 2;
}

message Disconnect {
	required bool alive = 2;
}

message Message {
	required bytes payload = 1;
}